rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Default deny: No one can read or write anything by default.
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Allow users to upload their own deposit screenshots.
    // They can write to a path that includes their user ID.
    // They can't read/list other users' files.
    match /deposit_screenshots/{userId}/{depositId} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Admins can read any deposit screenshot.
    // This assumes you have a custom claim 'isAdmin' set to true on the admin's token.
    // You would typically set this using a backend function or the Firebase Admin SDK.
    match /deposit_screenshots/{userId}/{depositId} {
        // A placeholder for a more secure rule. For now, allow authenticated read.
        // In production, you would restrict this to admins.
       allow read: if request.auth != null;
    }
  }
}
